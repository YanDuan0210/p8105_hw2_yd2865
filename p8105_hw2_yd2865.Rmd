---
title: "p8105_hw2_yd2865"
author: "Yan Duan"
date: "2025-09-16"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
library(tidyverse)
library(lubridate)
library(readxl)
```

I'm an R Markdown document! 


## Problem 1

#### Clean the data in pols-month.csv
```{r}
pols_df = 
  read_csv("./fivethirtyeight_datasets/pols-month.csv", na = c("NA", ".", "")) |> 
  janitor::clean_names() |> 
  separate(mon, into = c("year", "month", "day"), sep = "-" ) |>   # Use `separate()` to break up the variable `mon`
  mutate(
    year = as.integer(year),
    month = factor(month.name[as.integer(month)],
         levels = month.name),
         president =         # Create a `president` variable
           case_when(
             prez_gop == 1 ~ "gop",
             prez_dem == 1 ~ "dem")) |> 
  select(year, month, president, everything(), -day, -prez_gop, -prez_dem) |>  # Remove three variables
  arrange(year, month)
pols_df
```


#### Clean the data in snp.csv 
```{r}
snp_df = 
  read_csv("./fivethirtyeight_datasets/snp.csv", na = c("NA", ".", "")) |> 
  janitor::clean_names() |>
  separate(date, into = c("year", "month", "day"), sep = "/") |> 
  mutate(
   year = as.integer(year),
   year  = if_else(year <= 25, 2000L + year, 1900L + year),
   month = factor(month.name[as.integer(month)],
         levels = month.name)) |> 
  select(year, month, close) |> 
  arrange(year, month)
snp_df
```


#### Tidy the unemployment data 

```{r}
unemp_df =
  read_csv("./fivethirtyeight_datasets/unemployment.csv") |>
  janitor::clean_names() |>
  pivot_longer(                # Switching from “wide” to “long” format
    jan:dec,
    names_to = "month",
    values_to = "unemp_rate") |>
   mutate(         # Make sure that key variables have the same name and same values
    year = as.integer(year),
    month = match(str_to_title(month), month.abb),
    month = factor(month.name[as.integer(month)],
         levels = month.name)) |> 
  arrange(year, month)
unemp_df
```

#### Joining datasets

```{r}
# Join the datasets by merging `snp` into `pols`

pols_snp =
  left_join(pols_df, snp_df, by = c("year", "month")) 

# Merging `unemployment` into the result
merged_df = 
  left_join(pols_snp, unemp_df, by = c("year", "month")) 
merged_df
```

This analysis utilized three datasets: `pols-month.csv`, `snp.csv` and `unemployment.csv`. 

* The `pols_df` dataset, after being organized, contains monthly data on the political structure of the United States starting from 1947, including `year`, `month`, `president` (the political party of the president, `gop` or `dem`), and the distribution numbers of state governors, senators, and representatives between the two parties (such as `gov_gop`, `sen_gop`, `rep_dem`). 
* The `snp_df` provides the monthly closing prices of the S&P 500 index during the same period (use variable `close`), with `year` and `month` serving as the keys. 
* The variable `unemp_df` represents the monthly unemployment rate in the United States. Originally, it was stored in columns for 12 months. After being organized, it was transformed into "long format" and the same keys of `year` and `month` were used.

During the cleaning process, the date variables in all three datasets were unified into `year` and `month`, and the months were standardized to the full English names of the months to ensure a smooth merge. Eventually, we used the `left_join()` function to first merge the `snp_df` into the `pols_df`, and then merge the `unemp_df`, resulting in the `merged_df` data frame which contains approximately 1,571 monthly observation records. The time span ranges from January 1947 to around June 2015. 

The final table integrates the political structure, the closing prices of the stock market, and the unemployment rate, providing a complete time series of data for analyzing the relationship between the political and economic fluctuations in the United States.


## Problem 2

#### Read "Mr. Trash Wheel" table
```{r}
mr_df =
  read_excel(
    path  = "./Trash Wheel/202509 Trash Wheel Collection Data.xlsx",
    sheet = "Mr. Trash Wheel",
    na    = c("NA", ".", ""),
    skip  = 1,
    range = cell_cols("A:N")) |>
  mutate(wheel = "Mr",
         Year = as.integer(Year))               
```

#### Read "Professor Trash Wheel" table

```{r}
prof_df =
  read_excel(
    path  = "./Trash Wheel/202509 Trash Wheel Collection Data.xlsx",
    sheet = "Professor Trash Wheel",
    na    = c("NA", ".", ""),
    skip  = 1,
    range = cell_cols("A:M")) |>
  mutate(wheel = "Professor")    
```

#### Read "Gwynns Falls Trash Wheel" table

```{r}
gwyn_df =
  read_excel(
    path  = "./Trash Wheel/202509 Trash Wheel Collection Data.xlsx",
    sheet = "Gwynns Falls Trash Wheel",
    na    = c("NA", ".", ""),
    skip  = 1,
    range = cell_cols("A:L")) |>
  mutate(wheel = "Gwynnda")    
```

#### Tidy and clean data
```{r}
wheel_tidy = 
  bind_rows(mr_df, prof_df, gwyn_df) |>   # Merge the three datasets
  janitor::clean_names() |> 
  rename(                      # Change the variable name
      dumpster = dumpster,
      month = month,
      year  = year,
      date  = date,
      weight = starts_with("weight"),
      volume_cubic_yards = starts_with("volume"),
      plastic_bottles = starts_with("plastic_bottles"),
      polystyrene = starts_with("polystyrene"),
      cigarette = starts_with("cigarette"),
      glass = starts_with("glass"),
      plastic = starts_with("plastic"),
      wrappers = starts_with("wrappers"),
      sports = starts_with("sports"),
      homes = starts_with("homes")) |> 
  filter(!is.na(dumpster)) |>     # Remove the rows that do not have `dumpster` data
  mutate(date = as.Date(date),
         sports = ifelse(is.na(sports), NA_integer_, as.integer(round(sports))))# Round the number of sports balls to the nearest integer and convert the result into an integer variable.
wheel_tidy
```

#### The total number of observations after merging the datasets

```{r}
nrow(wheel_tidy)
```

#### Calculate the total weight of the trash of "Professor Trash Wheel"
```{r}
prof_total_weight =
  wheel_tidy |>
  drop_na(weight) |>
  filter(wheel == "Professor") |> 
  summarise(total_weight = sum(weight))
prof_total_weight
```

#### Calculate the total number of cigarette butts collected by Gwynnda in June 2022
```{r}
gwyn_cigs_jun22 =
  wheel_tidy |>
  drop_na(weight) |> 
  filter(wheel == "Gwynnda",
         year(date) == 2022, month(date) == 6) |>
  summarise(total_cigarette = sum(cigarette))
gwyn_cigs_jun22
```

This analysis utilized three datasets: "Mr. Trash Wheel", "Professor Trash Wheel" and "Gwynnda Falls Trash Wheel".

* `mr_df` represents the trash collection records of "Mr. Trash Wheel", including `dumpster` (trash bin number), `month`, `year`, `date`, `weight` (tons), `volume_cubic_yards` (cubic yards), and various variables representing the quantities of different types of trash items (such as `plastic_bottles`, `polystyrene`, `cigarette`, `glass`, `wrappers`, `sports`, `homes`).
* `prof_df` and `gwyn_df` contains similar records for "Professor Trash Wheel" and "Gwynnda Falls Trash Wheel", with the same variable structure as `mr_df`.

We used the `bind_rows()` function to combine the three datasets into a tidy data frame named `wheel_tidy`.
During the cleaning process, we standardized the variable names and data formats for the three datasets, and rounded the value of `sports` to an integer.
To distinguish the data from different devices, we added a variable `wheel` for each sub-dataset, with the values being `Mr`, `Professor` and `Gwynnda` respectively.

The post-organized `wheel_tidy` dataset contains a total of 1,188 observation records and 12 variables, which comprehensively reflects the trash collection situation of the three devices since their respective commissioning.


